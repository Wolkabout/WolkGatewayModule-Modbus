<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
		<meta http-equiv="X-UA-Compatible" content="IE=9"/>
		<meta name="generator" content="Doxygen 1.8.18"/>
		<meta name="viewport" content="width=device-width, initial-scale=1"/>
		<title>WolkGatewayModbule-Modbus: WolkGateway Module Modbus</title>
		<link href="tabs.css" rel="stylesheet" type="text/css"/>
		<script type="text/javascript" src="jquery.js"></script>
		<script type="text/javascript" src="dynsections.js"></script>
		<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
		<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
		<link href="doxygen.css" rel="stylesheet" type="text/css" />
		<link href="custom.css" rel="stylesheet" type="text/css"/>
<link href="custom_dark_theme.css" rel="stylesheet" type="text/css"/>
	</head>
	<body>
	<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
		<div id="titlearea">
			<table cellspacing="0" cellpadding="0">
				<tbody>
					<tr style="height: 56px;">
						<td id="projectalign" style="padding-left: 0.5em;">
							<div id="projectname">WolkGatewayModbule-Modbus
							</div>
						</td>
					</tr>
				</tbody>
			</table>
		</div>
		<!-- end header part --><!-- Generated by Doxygen 1.8.18 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('index.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">WolkGateway Module Modbus </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md_README"></a>WolkGateway module for connecting Modbus devices to WolkAbout IoT Platform by communicating with <a href="https://github.com/Wolkabout/WolkGateway">WolkGateway</a>.</p>
<p>Supported protocol(s):</p><ul>
<li>JSON_PROTOCOL</li>
</ul>
<h1><a class="anchor" id="autotoc_md1"></a>
Installing from source</h1>
<p>This repository must be cloned from the command line using: </p><div class="fragment"><div class="line">git clone --recurse-submodules https://github.com/Wolkabout/WolkGatewayModule-Modbus.git</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md2"></a>
Prerequisite</h1>
<p>Following tools/libraries are required in order to build WolkGateway Module Modbus</p>
<ul>
<li>cmake - version 3.5 or later</li>
<li>autotools</li>
<li>automake</li>
<li>autoconf</li>
<li>m4</li>
<li>zlib1g-dev</li>
<li>libtool</li>
<li>libssl</li>
</ul>
<p>Former can be installed on Debian based system from terminal by invoking: </p><div class="fragment"><div class="line">sudo apt-get install automake autotools-dev autoconf m4 zlib1g-dev cmake libtool libssl</div>
</div><!-- fragment --><p>Afterwards dependencies are built, and Makefile build system is generated by invoking: </p><div class="fragment"><div class="line">./configure</div>
</div><!-- fragment --><p>Generated build system is located inside <code>out</code> directory</p>
<p>WolkGateway Module Modbus library, is built from <code>out</code> directory by invoking <code>make</code> in terminal</p>
<h1><a class="anchor" id="autotoc_md3"></a>
Configuring Module</h1>
<p>Module configuration consists of 2 configurations files</p>
<ul>
<li>moduleConfiguration.json</li>
<li>devicesConfiguration.json</li>
</ul>
<p>Below are sections describing each of these configuration files that need to be edited with the parameters of your modbus devices before running the application. These files are located in <code>out</code> directory, and are passed to Modbus module executable in following manner: </p><div class="fragment"><div class="line">./modbusModule moduleConfiguration.json devicesConfiguration.json</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md4"></a>
moduleConfiguration.json</h1>
<p>Module configuration file contains settings that relate to communication with WolkGateway, and outgoing Modbus connection, reading period time and response timeout.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">    &quot;mqttHost&quot;: &quot;tcp://localhost:1883&quot;,  // Address of local MQTT broker (connection with WolkGateway) </div>
<div class="line">    &quot;connectionType&quot;: &quot;SERIAL/RTU&quot;,      // Modbus connection type, choice between &quot;SERIAL/RTU&quot; and &quot;TCP/IP&quot; </div>
<div class="line">    &quot;tcp/ip&quot;: {                          // TCP/IP connection properties (ignored if connectionType is &quot;SERIAL/RTU&quot;)</div>
<div class="line">        &quot;host&quot;: &quot;192.168.x.x&quot;,           // IP address of Modbus server (mandatory if connectionType is &quot;TCP/IP&quot;) </div>
<div class="line">        &quot;port&quot;: 502                      // Port of Modbus server (default is 502, if not stated)</div>
<div class="line">    },</div>
<div class="line">    &quot;serial/rtu&quot;: {                      // Serial/RTU connection properties (ignored if connectionType is &quot;TCP/IP&quot;) </div>
<div class="line">        &quot;serialPort&quot;: &quot;SERIAL_PORT&quot;,     // Serial port location such as /dev/ttyS0 (mandatory if connection type is &quot;SERIAL/RTU&quot;)</div>
<div class="line">        &quot;baudRate&quot;: 115200,              // Baud rate for serial connection (default is 115200, if not stated)</div>
<div class="line">        &quot;dataBits&quot;: 8,                   // DataBits for Modbus RTU (default is 8, if not stated) </div>
<div class="line">        &quot;stopBits&quot;: 1,                   // StopBits for Modbus RTU (default is 1, if not stated)</div>
<div class="line">        &quot;bitParity&quot;: &quot;NONE&quot;              // BitParity for Modbus RTU, can be &quot;NONE&quot;, &quot;EVEN&quot;, &quot;ODD&quot; (default is &quot;NONE&quot;, if not stated)</div>
<div class="line">    },</div>
<div class="line">    &quot;responseTimeoutMs&quot;: 200,            // Wait time for respond from slaves/servers (default is 200, if not stated)</div>
<div class="line">    &quot;registerReadPeriodMs&quot;: 500          // Period of reading all registers/devices (default is 500, if not stated) </div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md5"></a>
devicesConfiguration.json</h1>
<p>Devices configuration file contains information necessary to define templates, which include registers that bind to Wolkabout IoT Platform sensors/actuators/alarms/configurations, and then devices, with their information, and a template. This is the guide by which the module will register devices, and then send data for.</p>
<p>You define templates, that are described by their name, and mappings.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">  &quot;templates&quot;: [</div>
<div class="line">     {</div>
<div class="line">        &quot;name&quot;: &quot;&lt;TEMPLATE_NAME&gt;&quot;,</div>
<div class="line">        &quot;mappings&quot;: [</div>
<div class="line">            // define mappings</div>
<div class="line">        ]</div>
<div class="line">     }</div>
<div class="line">  ]</div>
<div class="line">}</div>
</div><!-- fragment --><p>After doing so, you define all the mappings inside a template. If you happen to be familiar with how this worked in earlier versions, this will look familiar. The only change happens with the slaveAddress, which isn't listed here anymore. We will get back to that later.</p>
<p>Single mapping includes one or more Modbus registers that produce a single sensor/actuator/alarm/configuration on a device, on the platform. They're characterized by a name and a reference key, used to identify them, by their register type, data type, and mapping type.</p>
<p>Register types:</p>
<ul>
<li>Read &amp; Write:<ul>
<li><code>COIL</code> (implies a single bit, or boolean on platform)</li>
<li><code>HOLDING_REGISTER_ACTUATOR</code> (implies either a 16bit or 32bit register, data type must be specified)</li>
</ul>
</li>
<li>Read Only:<ul>
<li><code>HOLDING_REGISTER_SENSOR</code> (same as <code>HOLDING_REGISTER_ACTUATOR</code>)</li>
<li><code>INPUT_REGISTER</code> (same as <code>HOLDING_REGISTER_ACTUATOR</code>)</li>
<li><code>INPUT_CONTACT</code> (same as <code>COIL</code>)</li>
</ul>
</li>
</ul>
<p>Mappings are by default registered as:</p><ul>
<li>Sensors for read only types</li>
<li>Actuator for read &amp; write types</li>
</ul>
<p>You can override this behaviour by adding a field to the mapping, stating one of the next types:</p><ul>
<li><code>SENSOR</code></li>
<li><code>ACTUATOR</code></li>
<li><code>ALARM</code> - only for <code>INPUT_CONTACT</code></li>
<li><code>CONFIGURATION</code> - only for <code>COIL</code> and <code>HOLDING_REGISTER_ACTUATOR</code> (where <code>HOLDING_REGISTER_ACTUATOR</code> can also be multi value)</li>
</ul>
<p>A mapping that has the register type <code>HOLDING_REGISTER_ACTUATOR</code> and is a <code>CONFIGURATION</code> can be multi-value. What that means, is that it can combine multiple registers into a single configuration. That configuration has label for each of its values, which you assign in the <code>labelMap</code>. <em>Note that you can have a total maximum of <b>3</b> values inside a multi-value configuration!</em></p>
<div class="fragment"><div class="line">{</div>
<div class="line">   // Inside of a template</div>
<div class="line">   &quot;name&quot;: &quot;&lt;TEMPLATE_NAME&gt;&quot;,</div>
<div class="line">   &quot;mappings&quot;: [</div>
<div class="line">      {</div>
<div class="line">         &quot;name&quot;:&quot;mappingName&quot;,              // Register name</div>
<div class="line">         &quot;reference&quot;: &quot;mappingReference&quot;,   // Unique reference used to differ register on WolkAbout IoT Platform</div>
<div class="line">         &quot;minimum&quot;: -32768,                 // Minimum value that can be held in register. Required for visualization on WolkAbout IoT Platform</div>
<div class="line">         &quot;maximum&quot;: 32767,                  // Maximum value that can be held in register. Required for visualization on WolkAbout IoT Platform</div>
<div class="line">         &quot;address&quot;: 0,                      // Register address</div>
<div class="line">         &quot;registerType&quot;: &quot;INPUT_REGISTER&quot;,  // Register type - &quot;INPUT_REGISTER&quot; or &quot;HOLDING_REGISTER_ACTUATOR&quot; or &quot;HOLDING_REGISTER_SENSOR&quot; or &quot;INPUT_CONTACT&quot; or &quot;COIL&quot;</div>
<div class="line">         &quot;dataType&quot;: &quot;INT16&quot;                // Data type stored in register - &quot;INT16&quot; or &quot;UINT16&quot; or &quot;REAL32&quot; for &quot;INPUT_REGISTER&quot;/&quot;HOLDING_REGISTER_ACTUATOR&quot;/&quot;HOLDING_REGISTER_SENSOR&quot; register type, and &quot;BOOL&quot; for &quot;COIL&quot;/&quot;INPUT_CONTACT&quot;</div>
<div class="line">      },</div>
<div class="line">      {</div>
<div class="line">         &quot;name&quot;:&quot;mappingName2&quot;,</div>
<div class="line">         &quot;reference&quot;: &quot;mappingReference2&quot;,</div>
<div class="line">         &quot;minimum&quot;: -4000,</div>
<div class="line">         &quot;maximum&quot;: 4000,</div>
<div class="line">         &quot;address&quot;: 1,</div>
<div class="line">         &quot;registerType&quot;: &quot;HOLDING_REGISTER_ACTUATOR&quot;,</div>
<div class="line">         &quot;dataType&quot;: &quot;REAL32&quot;</div>
<div class="line">      },</div>
<div class="line">      {</div>
<div class="line">         &quot;name&quot;: &quot;mappingName3&quot;,</div>
<div class="line">         &quot;reference&quot;: &quot;mappingReference3&quot;,</div>
<div class="line">         &quot;address&quot;: 1,</div>
<div class="line">         &quot;registerType&quot;: &quot;INPUT_CONTACT&quot;,</div>
<div class="line">         &quot;dataType&quot;: &quot;BOOL&quot;,</div>
<div class="line">         &quot;mappingType&quot;: &quot;ALARM&quot;              // This is where for the first time, we override the default Mapping type</div>
<div class="line">      },</div>
<div class="line">      {</div>
<div class="line">         &quot;name&quot;:&quot;mappingName4&quot;,</div>
<div class="line">         &quot;reference&quot;: &quot;mappingReference4&quot;,</div>
<div class="line">         &quot;address&quot;: 2,</div>
<div class="line">         &quot;registerType&quot;: &quot;COIL&quot;,</div>
<div class="line">         &quot;dataType&quot;: &quot;BOOL&quot;,</div>
<div class="line">         &quot;mappingType&quot;: &quot;CONFIGURATION&quot;</div>
<div class="line">      },</div>
<div class="line">      {</div>
<div class="line">         &quot;name&quot;: &quot;mappingName5&quot;,</div>
<div class="line">         &quot;reference&quot;: &quot;mappingReference5&quot;,</div>
<div class="line">         &quot;minimum&quot;: 0,</div>
<div class="line">         &quot;maximum&quot;: 1000,</div>
<div class="line">         &quot;labelMap&quot;: {                       // If you want to use a multi-value numeric configuration</div>
<div class="line">            &quot;firstConfig&quot;: 0,                // You can use the label map, to name the labels inside the configuration</div>
<div class="line">            &quot;secondConfig&quot;: 1,               // And assign a register address to each of them</div>
<div class="line">            &quot;thirdConfig&quot;: 2                 // Multi-value is only available for HOLDING_REGISTER_ACTUATOR </div>
<div class="line">         },</div>
<div class="line">         &quot;registerType&quot;: &quot;HOLDING_REGISTER_ACTUATOR&quot;,</div>
<div class="line">         &quot;dataType&quot;: &quot;INT16&quot;,</div>
<div class="line">         &quot;mappingType&quot;: &quot;CONFIGURATION&quot;</div>
<div class="line">      },</div>
<div class="line">      {</div>
<div class="line">         &quot;name&quot;:&quot;mappingName6&quot;,</div>
<div class="line">         &quot;reference&quot;: &quot;mappingReference6&quot;,</div>
<div class="line">         &quot;address&quot;: 3,</div>
<div class="line">         &quot;registerType&quot;: &quot;COIL&quot;,</div>
<div class="line">         &quot;dataType&quot;: &quot;BOOL&quot;</div>
<div class="line">      }</div>
<div class="line">   ]</div>
<div class="line">}</div>
</div><!-- fragment --><p>After you completely defined a template, you can list a device.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">    &quot;devices&quot;: [</div>
<div class="line">        {</div>
<div class="line">            &quot;name&quot;: &quot;&lt;DEVICE_NAME&gt;&quot;,         // User readable device name, necessary to register a device</div>
<div class="line">            &quot;key&quot;: &quot;&lt;DEVICE_KEY&gt;&quot;,           // Unique device key</div>
<div class="line">            &quot;slaveAddress&quot;: 1,               // Slave address (obligatory if connection type is &quot;SERIAL/RTU&quot;), must be unique in this list </div>
<div class="line">            &quot;template&quot;: &quot;&lt;TEMPLATE_NAME&gt;&quot;    // Name of defined template </div>
<div class="line">        }</div>
<div class="line">        // other devices</div>
<div class="line">    ]</div>
<div class="line">    // templates</div>
<div class="line">}</div>
</div><!-- fragment --><p>In "TCP/IP" mode, device count is maxed at 1, and you don't need to state a slaveAddress for the device.</p>
<p>If the user happens to enter an invalid template name, the device won't be created. Module will function if at least one device is valid. If there's no devices that have been inputted correctly, the module will exit out, and used will be notified. </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
		<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
			<ul>
				<li class="footer">
					Generated on Mon Apr 6 2020 12:52:03 for WolkGatewayModbule-Modbus by <a href="http://www.doxygen.org/index.html">
					<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.18.
					Dark theme by <a href="http://majerle.eu" target="_new">Tilen Majerle</a>. All rights reserved.
				</li>
			</ul>
		</div>
		<script src="custom.js"></script>
	</body>
</html>